---
title:  "next/Image와 캐싱 톺아보기"
date: 2025-03-15
desc: 테스트 설명 
thumbnail: /next.png
isHot: true
---

![테스트 포스트](/next.png)

## '뒤로 가기'시 이전 페이지의 스크롤 위치 그대로 유지하는 기능 구현

​next/Image와 상호작용하는 캐시는 크게 세 종류가 있습니다.
 

1. server cache

2. CDN cache

3. client cache

      - browser cache

      - http cache

 

일단 서버 캐시와 클라이언트 캐시의 차이부터 짚고 넘어갑시다. 

서버 캐시와 클라이언트 캐시의 차이점 (요청 시간 개선)

서버 캐시:
서버 캐시가 있다는 것은, 서버가 이미 이미지를 한 번 최적화하거나 생성한 이미지를 저장해 놓고, 이후의 요청에 대해서는 이미 저장된 이미지를 빠르게 제공할 수 있다는 뜻입니다.
하지만 이때 요청 자체는 여전히 서버로 가야 하므로, 클라이언트는 서버로 HTTP 요청을 보내고 응답을 기다리는 시간이 소요됩니다.
즉, 서버 캐시가 있더라도, 서버와 네트워크를 통한 요청-응답 과정이 여전히 존재하므로 요청 시간을 절약할 수 있는 것은 아닙니다.
클라이언트 캐시:
클라이언트 캐시를 사용하면, 이미 이미지가 로컬에 저장되어 있기 때문에, 서버에 대한 요청을 아예 하지 않고 클라이언트에서 바로 이미지를 불러옵니다.
요청 자체가 없기 때문에, 네트워크 요청을 보내고 기다리는 시간을 완전히 제거할 수 있습니다.
즉, 클라이언트 캐시가 활성화되면, 이미 로컬에 있는 이미지를 즉시 로드할 수 있기 때문에, 요청 시간을 대폭 단축시킬 수 있습니다.

```tsx
이 때 클라이언트 캐시는 Browser Cache와 HTTP Cache를 모두 포함하는 개념입니다.

1. 브라우저 캐시 (Browser Cache)
브라우저 캐시는 사용자의 브라우저가 관리하는 캐시로, 주로 정적 리소스(이미지, CSS, JavaScript 파일 등)를 저장합니다.사용자가 웹사이트를 처음 방문할 때, 브라우저는 서버에서 리소스를 다운로드하여 로컬에 저장하고, 이후 동일한 리소스를 다시 요청할 때 서버에 요청하지 않고 로컬에서 불러옵니다.예를 들어, 사용자가 나무 이미지를 요청했을 때, 이 이미지는 브라우저 캐시에 저장되어 이후 다시 요청할 때 빠르게 로드됩니다.

2. HTTP 캐시 (HTTP Cache)
HTTP 캐시는 HTTP 프로토콜에 따라 서버와 클라이언트(브라우저) 간에 데이터를 캐시하는 방식입니다.HTTP 헤더(Cache-Control, ETag, Last-Modified 등)를 사용하여, 서버는 클라이언트에게 어떤 리소스를 캐시할지, 얼마나 오랫동안 캐시할지 등의 정보를 전달합니다.클라이언트는 이러한 정보를 바탕으로 데이터를 로컬에 저장하고, 이후 새로운 요청을 할 때 캐시된 데이터를 사용하거나, 캐시가 만료되면 서버로 다시 요청을 보냅니다.HTTP 캐시는 브라우저 캐시의 일환으로 관리되기도 하며, 캐시된 데이터를 재사용하거나 서버로부터 데이터를 새로 받아오는 방식으로 작동합니다.
```
 

Next/Image 와 캐싱 및 성능개선 

서버사이드 캐시 (Server-Side Cache): 서버에서 이미지 최적화를 처리하고, 그 결과를 캐싱하는 방식입니다.
예를 들어, 서버가 이미지를 요청받았을 때 그 이미지를 최적화하고,
이후 동일한 이미지에 대한 요청은 이미 최적화된 이미지를 제공하는 방식입니다.
이 캐시는 주로 서버에서 처리하는 요청에 대해 성능을 향상시키기 위해 사용됩니다
🔍 .next/cache/image
Next.js 서버에서 이미지 최적화 결과를 저장하는 캐시입니다
서버가 이미지를 리사이징, WebP 변환 등의 작업을 한 후, 결과물을 이 폴더에 저장합니다
같은 이미지 요청이 들어오면, 다시 최적화하지 않고 여기서 가져옵니다.
브라우저(클라이언트)에서는 직접 이 폴더를 참조하지 않습니다.
 

 

CDN 캐시 (Content Delivery Network Cache): 이미지가 CDN(콘텐츠 전송 네트워크)을 통해 전달될 때 CDN 서버에 캐시됩니다. 이 캐시는 전 세계 여러 서버에 분산되어 있어, 사용자에게 더 빠르게 이미지를 제공할 수 있습니다. next/image에서 loader 설정을 통해 CDN을 사용하는 경우 이 캐시가 활성화됩니다.
브라우저 캐시 (Browser Cache): 사용자의 브라우저에서 이미지를 캐싱하여, 같은 이미지를 다시 로드할 때 빠르게 불러올 수 있도록 합니다. 브라우저는 이미지의 Cache-Control 헤더에 따라 캐시 여부를 결정하고, 일정 시간이 지나면 캐시가 만료되어 다시 서버로 요청하게 됩니다.
 

보완해서 볼 글 : https://oliveyoung.tech/2023-06-09/nextjs-image-optimization/
 




