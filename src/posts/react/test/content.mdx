---
title:  "무한 스크롤 페이지에서 스크롤 위치 복원"
date: 2024-08-15
desc: 테스트 설명 
thumbnail: /posts/test/thumbnail.jpeg
isHot: true
---

![테스트 포스트](/posts/test/thumbnail.jpeg)

## '뒤로 가기'시 이전 페이지의 스크롤 위치 그대로 유지하는 기능 구현

​
캐시에서 사용할 수 없는 이유
서버에서 요청했던 데이터들을 특정 공간 어딘가에 저장했다가 그 데이터가 다시 필요할 때 서버의 요청 없이 바로 가져와 사용하여 웹 성능을 최적화 시킬 수 있는 브라우저 기능이다. => 서버에서 가져온 정적/동적 데이터뿐

​-해당 페이지의 DOM 요소와 State까지는 캐싱이 되지 않고 사라지게 되어 다른 페이지로 넘어가는 순간 해당 페이지 화면에 대한 상태는 더 이상 기억할 수 없게 된다.

​localStorage stores data persistently across browser sessions (it remains until explicitly deleted).
sessionStorage stores data for the duration of a page session (it is cleared when the browser tab or window is closed).
​
무한 스크롤 리스트에는 뒤로가기를 갔다가 보던 위치를 기억해주는 기능은 UX적으로 필수적이다.

다른 페이지에 갔다가 뒤로가기로 페이지에 돌아올 경우,

더보기로 새로 로드된 데이터는 초기화되고 없으므로 실제로 보던 위치로 돌아가지 못하는 문제가 있다. sessionStorage를 사용해서 해결한 방법을 적고자한다.
 

우선 리스트에서 상품을 클릭할때 sessionStorage에 현재 스크롤 위치와 로드한 데이터를 저장한다.

```tsx
const handleProductClick = async () => {
  await setScrollDataInStorage();
  handleChangeLocation(`${publicRuntimeConfig.config.productHost}/product/${product.productId}`);
};

const setScrollDataInStorage = async () => {
  if (props.scrollPosition) {
    sessionStorage.setItem('scrollPosition', props.scrollPosition.toString());

    if (props.productList) {
      sessionStorage.setItem('selectedProductList', JSON.stringify(props.productList));
    }
    if (props.hasMoreProduct) {
      sessionStorage.setItem('hasMoreProduct', props.hasMoreProduct.toString());
    }
  }
};
```

컴포넌트 상위에 ref를 주어서 스크롤 될때마다 현재 스크롤 값을 state에 저장한다.

현재 페이지에 돌아올때 sessionStorage에 저장된 상품리스트 값이 있으면 해당 데이터를 보여주고 없다면 새로 로드한다.

저장된 상품리스트가 있을 때에는 쿼리를 따로 치지 않고 갖고 있는 데이터를 보여주므로 비용적인 면에서도 용이하다.

상품 리스트 값이 바뀌면 스크롤 위치값을 sessionStorage에 저장된 스크롤 위치값으로 셋팅해준다.

```tsx
const scrollRef = useRef(null);
const [scrollPosition, setScrollPosition] = useState(0);
const [productList, setProductList] = useState < IProduct[] > ([]);
const [isScrollRestored, setIsScrollRestored] = useState<boolean>(false);

useEffect(() => {
  const savedScrollPosition = JSON.parse(sessionStorage.getItem('selectedProductList'));
  if (!savedScrollPosition) {
    getProduct(); // 상품을 fetch하는 lazyQuery
  } else {
    setProductList(savedScrollPosition);
  }
}, []);

useEffect(() => {
  setScrollPosition(Number(sessionStorage.getItem('scrollPosition')));
  scrollRef.current?.scrollTo(0, scrollPosition);
  if (sessionStorage.getItem('scrollPosition')) {
    setIsScrollRestored(true);
  }
}, [productList]);

// 복원 후에는 저장된 storage 값을 제거해서 다시 그 위치로 복원되지 않도록 하는 로직을 추가했다.
useEffect(() => {
  if (isScrollRestored) {
    sessionStorage.removeItem('selectedProductList');
    sessionStorage.removeItem('scrollPosition');
  }
}, [isScrollRestored]);


return (
  <div
    style={{ overflow: 'auto' }}
    ref={scrollRef}
    onScroll={({ target }: any) => { setScrollPosition(target.scrollTop); }}
  >
  ...
  </div>
)
```
 




