---
title:  "react-nativeë¡œ fcm êµ¬í˜„ ë° next.jsì™€ ì—°ë™í•˜ê¸°"
date: 2024-09-04
desc: ì²«ë²ˆì§¸ ì„¤ëª…
thumbnail: /rn.png
isHot: true
---

![](/rn.png)


---

## ê°œìš”

âœ… React Nativeì—ì„œ FCM í† í°ì„ Next.jsë¡œ ë³´ëƒ„
âœ… Next.jsì—ì„œ React Nativeë¡œ í‘¸ì‹œ ì•Œë¦¼ì„ ì „ì†¡

 

ğŸ”¹ React Nativeì—ì„œ FCM êµ¬í˜„

Firebase ì„¤ì •
Firebase ì½˜ì†”ì—ì„œ í”„ë¡œì íŠ¸ ìƒì„±
iOS: GoogleService-Info.plist ì¶”ê°€
Android: google-services.json ì¶”ê°€
í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
 
npm install @react-native-firebase/app @react-native-firebase/messaging
FCM ì„¤ì • (ì˜ˆì œ ì½”ë“œ)
 

```tsx
ğŸ”¹ React Nativeì—ì„œ FCM êµ¬í˜„
Firebase ì„¤ì •

Firebase ì½˜ì†”ì—ì„œ í”„ë¡œì íŠ¸ ìƒì„±
iOS: GoogleService-Info.plist ì¶”ê°€
Android: google-services.json ì¶”ê°€
í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜

sh
npm install @react-native-firebase/app @react-native-firebase/messaging
FCM ì„¤ì • (ì˜ˆì œ ì½”ë“œ)

tsx

import messaging from '@react-native-firebase/messaging';
import { useEffect } from 'react';
import { Alert } from 'react-native';

const useFCM = () => {
  useEffect(() => {
    // ê¶Œí•œ ìš”ì²­ (iOS)
    messaging().requestPermission();

    // í† í° ê°€ì ¸ì˜¤ê¸°
    messaging()
      .getToken()
      .then(token => console.log('FCM Token:', token));

    // í¬ê·¸ë¼ìš´ë“œ ë©”ì‹œì§€ ìˆ˜ì‹ 
    const unsubscribe = messaging().onMessage(async remoteMessage => {
      Alert.alert('New Notification', JSON.stringify(remoteMessage));
    });

    return unsubscribe;
  }, []);
};

export default useFCM;
```
âœ… WebView ë°©ì‹ì—ì„œ FCM ì ìš© ì˜ˆì œ

## 1ï¸âƒ£ React Nativeì—ì„œ FCM í† í° Next.jsë¡œ ì „ì†¡

```tsx
import messaging from '@react-native-firebase/messaging';

const sendTokenToServer = async (token: string) => {
  await fetch('https://your-nextjs-app.com/api/registerToken', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ token }),
  });
};

const requestFCMToken = async () => {
  const token = await messaging().getToken();
  if (token) {
    await sendTokenToServer(token);
  }
};
```
ì„¤ëª…

-React Nativeì—ì„œ FCM í† í°ì„ ê°€ì ¸ì™€ Next.jsë¡œ ë³´ëƒ„

-Next.js ì„œë²„ì—ì„œ ì´ í† í°ì„ ì €ì¥ (DB ë˜ëŠ” ìºì‹œ) 

## 2ï¸âƒ£ Next.js APIì—ì„œ í† í° ì €ì¥

(ğŸ“Œ /pages/api/registerToken.ts)

```tsx
import type { NextApiRequest, NextApiResponse } from 'next';

// DB ëŒ€ì‹  ì„ì‹œ ì €ì¥ (ì‹¤ì œ ì•±ì—ì„œëŠ” DB ì‚¬ìš©)
const tokens: string[] = [];

export default function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method === 'POST') {
    const { token } = req.body;
    if (token && !tokens.includes(token)) {
      tokens.push(token); // ì €ì¥
      console.log('FCM Token Registered:', token);
    }
    return res.status(200).json({ success: true });
  }
  res.status(405).json({ error: 'Method not allowed' });
}
```

## 3ï¸âƒ£ Next.jsì—ì„œ React Nativeë¡œ í‘¸ì‹œ ì•Œë¦¼ ë³´ë‚´ê¸°

(ğŸ“Œ /pages/api/sendNotification.ts)

```tsx
import type { NextApiRequest, NextApiResponse } from 'next';
import admin from 'firebase-admin';

// Firebase Admin ì´ˆê¸°í™” (ì„œë²„ì—ì„œ FCM ì‚¬ìš©)
if (!admin.apps.length) {
  admin.initializeApp({
    credential: admin.credential.cert({
      projectId: process.env.FIREBASE_PROJECT_ID,
      clientEmail: process.env.FIREBASE_CLIENT_EMAIL,
      privateKey: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g, '\n'),
    }),
  });
}

// ì €ì¥ëœ FCM í† í° (ì‹¤ì œ ì•±ì—ì„œëŠ” DBì—ì„œ ê°€ì ¸ì˜´)
const tokens: string[] = []; 

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method === 'POST') {
    const { title, body } = req.body;

    try {
      const response = await admin.messaging().sendMulticast({
        tokens,
        notification: { title, body },
      });

      console.log('Push notification sent:', response);
      return res.status(200).json({ success: true });
    } catch (error) {
      console.error('Error sending notification:', error);
      return res.status(500).json({ error: error.message });
    }
  }
  res.status(405).json({ error: 'Method not allowed' });
}

```